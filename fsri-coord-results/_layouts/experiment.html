---
layout: base
custom_js:
    - 'experiment.js'
---

<div class="experiment" layout="column" layout-align="start center" flex>
    {% if page.floors %}
    <div class="floors" layout="column" layout-align="start center">
        <div layout="column" layout-gt-sm="row" layout-align="center start" >
            {% for floor in page.floors %}
            <div class="floorplan {% if forloop.first != true %}-hide{% endif %}" data-floor="{{ forloop.index }}">
                <img class="base-image" src="{{ page.group | append:'/' | append: page.experiment | append:'/' | append: floor.floor_plan | asset_path }}"/>
                {% if floor.sensors %}
                    {% for sensor_hash in floor.sensors %}
                        {% for sensor in sensor_hash[1] %}
                            {% assign coords = sensor.coords | remove: ' ' | split: ',' %}
                            {% assign plot_filename_parts = sensor.plot | split: '.' %}

                            {% if floor.icon_width %}
                              {% assign icon_width = floor.icon_width %}
                            {% else %}
                              {% assign icon_width = '2%' %}
                            {% endif %}

                            {% if sensor_hash[0] == 'temperature' %}
                              {% assign icon_img = 'legend-icon-thermocouple-array.png' %}
                            {% elsif sensor_hash[0] == 'pressure' %}
                              {% assign icon_img = 'legend-icon-pressure.png' %}
                            {% elsif sensor_hash[0] == 'heat_flux' %}
                              {% assign icon_img = 'legend-icon-heat-flux.png' %}
                            {% elsif sensor_hash[0] == 'gas' %}
                              {% assign icon_img = 'legend-icon-gas.png' %}
                            {% elsif sensor_hash[0] == 'moisture' %}
                              {% assign icon_img = 'legend-icon-moisture.png' %}
                            {% elsif sensor_hash[0] == 'skin_temp' %}
                              {% assign icon_img = 'legend-icon-skin-temp.png' %}
                            {% else %}
                              {% assign icon_img = nil %}
                            {% endif %}

                            <div class="sensor" floordata-fancybox="sensors" data-caption="{{ plot_filename_parts[0] }}"
                                 data-src="{{ site.baseurl | append: '/' | append: page.group | append:'/' | append: page.experiment | append:'/plots/' | append: sensor.plot }}"
                                 style="left: {{ coords[0] }}; top: {{ coords[1] }};width: {{icon_width}};">
                              {% if icon_img %}<img src="{{icon_img | asset_path}}" />{% endif %}
                            </div>
                        {% endfor %}
                    {% endfor %}
                {% endif %}
                {% if floor.panoramas %}
                    {% assign hasPanoramas = true %}
                    {% for panorama in floor.panoramas %}
                        {% assign coords = panorama.coords | remove: ' ' | split: ',' %}
                        {% for image in panorama.images %}
                            {% assign image_path = page.group | append:'/' | append: page.experiment | append:'/exp_images/' | append: image.image | asset_path %}
                            {% if image.caption %}
                                {% assign caption = image.caption %}
                            {% else %}
                                {% assign image_filename_parts = image.image | split: '.' %}
                                {% assign caption = image_filename_parts[0] %}
                            {% endif %}
                            <img class="panorama" src="{{ '360_icon' | asset_path }}" data-fancybox="{{ panorama.name }}"
                                 data-caption="{{ caption }}" data-src="{{ site.baseurl | append: '/index_2.html?image=' | append: image_path | append: '&is_stereo=false' }}"
                                 style="left: {{ coords[0] }}; top: {{ coords[1] }};" />
                        {% endfor %}
                    {% endfor %}
                {% endif %}
            </div>
            {% endfor %}

            <div class="controls" layout="row" layout-gt-sm="column" layout-xs="column" layout-align="start start">
                <div class="section layers" layout="row" layout-gt-sm="column" layout-align="start center">
                    <div class="header">Layers</div>
                    {% if hasPanoramas %}
                      <div class="button active panoramas" title="360s" data-tippy-placement="left" layout="column" layout-align="center center">
                          <span class="icon-360"></span>
                      </div>
                    {% endif %}
                    <div class="button active sensors" title="Sensors" data-tippy-placement="left" layout="column" layout-align="center center">
                        <span class="icon-sensors"></span>
                    </div>
                </div>
                <div class="section floors" layout="row" layout-gt-sm="column" layout-align="start center">
                    <div class="header">Floors</div>
                    {% for floor in page.floors %}
                    {% assign floor_number = page.floors | size | minus: forloop.index0 %}
                    <div class="button {% if floor_number == 1 %}active{% endif %}"
                         layout="column" layout-align="center center" data-floor="{{ floor_number }}">
                        {{ floor_number }}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="legend" layout="column" layout-align="start start">
            <div class="header">Instrumentation Legend</div>
            <div layout="row">
                <div class="item" layout="row" layout-align="start center">
                    <div class="icon pressure"></div>
                    <div>Pressure</div>
                </div>
                <div class="item" layout="row" layout-align="start center">
                    <div class="icon heat_flux"></div>
                    <div>Heat Flux</div>
                </div>
                <div class="item" layout="row" layout-align="start center">
                    <div class="icon gas"></div>
                    <div>Gas Concentration</div>
                </div>
                <div class="item" layout="row" layout-align="start center">
                    <div class="icon temperature"></div>
                    <div>Thermocouple Array</div>
                </div>              
                <div class="item" layout="row" layout-align="start center">
                    <div class="icon skin_temp"></div>
                    <div>Skin Temperature</div>
                </div>
                <div class="item" layout="row" layout-align="start center">
                    <div class="icon moisture"></div>
                    <div>Water Vapor</div>
                </div>  
            </div>
        </div>
    </div>
    {% endif %}

    <div class="experiment-body" layout="row" layout-sm="column" layout-xs="column">
        <div layout="column" flex="100" {% if page.group != 'etr' %}flex-gt-sm="60"{% endif %}>
            <div class="body-content">
                <h1>{{ page.title }}</h1>
                {{ content }}

                {% if page.group == 'etr' %}
                <table class="etr-table">
                <thead>
                    <tr>
                      <th>Circuit #</th>
                      <th>Circuit Type</th>
                      <th>Wire Type</th>
                      <th>Trip Type</th>
                      <th>Time to Trip</th>
                  </tr>
                </thead>
                <tbody>
                    {% for circuit in page.circuits %}
                    {% assign plot_filename_parts = circuit.plot | split: '.' %}
                    <tr class="clickable-row circuit" data-fancybox="circuits" data-caption="{{ plot_filename_parts[0] }}"
                        data-src="{{ site.baseurl | append:'/' | append: page.group | append:'/' | append: page.experiment | append:'/plots/' | append: circuit.plot }}">
                      <td>{{ circuit.number }}</td>
                      <td>{{ circuit.type }}</td>
                      <td>{{ circuit.wire_type }}</td>
                      <td>{{ circuit.trip_type }}</td>
                      <td>{{ circuit.time_to_trip }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                </table>
                {% endif %}

                {% if page.video %}
                <h2>Experiment Video</h2>
                <iframe class="video" src="{{ page.video }}" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
                {% endif %}
                
                {% include disqus.html %}
            </div>
        </div>
        {% if page.group != 'etr' %}
        <div class="callout" layout="column" flex>
            {% include timeline.html %}
            {% include training_resources.html %}
        </div>
        {% endif %}
    </div>
</div>
